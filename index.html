<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Jeu de Gages Correctif</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #000;
      font-family: "Segoe UI", sans-serif;
      color: #fff;
    }

    /* ===== Menu flottant ===== */
    .menu-button {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 100;
      padding: 10px 15px;
      border-radius: 8px;
      background-color: rgba(50,50,50,0.8);
      cursor: pointer;
      user-select: none;
      font-weight: bold;
    }

    .filters {
      position: fixed;
      top: 50px;
      left: 10px;
      background: rgba(50,50,50,0.95);
      padding: 10px;
      border-radius: 10px;
      display: none;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
      max-height: 90%;
      overflow-y: auto;
    }

    .filters select, .filters button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      background-color: #222;
      color: #fff;
      cursor: pointer;
    }

    .filters button {
      background-color: #4CAF50;
    }

    .filters button:hover { background-color: #3a9c42; }

    .game-container {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #gif {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #gif.visible { opacity: 1; }

    #texte {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      font-size: 6vw;
      font-weight: bold;
      text-align: center;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.7);
      opacity: 0;
      max-width: 90%;
      word-break: break-word;
      pointer-events: none;
    }

    #texte span {
      opacity: 0;
      display: inline-block;
      transition: opacity 0.3s;
    }

    #texte.visible span { opacity: 1; }

    /* ===== Partie Admin ===== */
    #admin {
      margin-top: 10px;
      display: none;
    }

    #admin h2 { margin-top: 0; }

    #admin table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    #admin table, #admin th, #admin td {
      border: 1px solid #555;
    }

    #admin th, #admin td {
      padding: 5px;
      text-align: left;
    }

    #admin input, #admin select { padding: 5px; margin-bottom: 5px; }
    #admin button { padding: 5px 10px; margin-right: 5px; background-color:#4CAF50; border:none; color:#fff; cursor:pointer; border-radius:4px; }
    #admin button.delete { background-color:#e74c3c; }

    /* ===== Desktop / Mobile ===== */
    @media (min-width: 768px) {
      #admin { display: block; }
    }
  </style>
</head>
<body>

  <!-- Partie Jeu -->
  <div class="menu-button" id="menuButton">‚ò∞ Menu</div>
  <div class="filters" id="filtersMenu">
    <h3>Filtres du jeu</h3>
    <select id="niveau"><option value="">Niveau</option><option value="mains">Avec les mains</option><option value="bouche">Avec la bouche</option><option value="avanc√©">Avec son sexe</option></select>
    <select id="ambiance"><option value="">Ambiance</option><option value="romantique">Romantique</option><option value="domination">Domination</option><option value="bondage">Bondage</option></select>
    <select id="genre"><option value="">Genre</option><option value="homme">Homme</option><option value="femme">Femme</option></select>
    <select id="lieu"><option value="">Lieu</option><option value="int√©rieur">Int√©rieur</option><option value="ext√©rieur">Ext√©rieur</option></select>
    <select id="type_special"><option value="">Anal ?</option><option value="oui">Oui</option><option value="non">Non</option></select>
    <button id="btnTirer">üé≤ Tirer un gage</button>

    <!-- Onglet Admin visible desktop -->
    <div id="admin">
      <h2>Admin - G√©rer les gages</h2>
      <form id="formGage">
        <input type="hidden" id="gage_id">
        <input type="text" id="texteAdmin" placeholder="Texte du gage" required>
        <input type="text" id="gif_urlAdmin" placeholder="URL du GIF">
        <select id="niveauAdmin"><option value="mains">Avec les mains</option><option value="bouche">Avec la bouche</option><option value="avanc√©">Avec son sexe</option></select>
        <select id="ambianceAdmin"><option value="romantique">Romantique</option><option value="domination">Domination</option><option value="bondage">Bondage</option></select>
        <select id="genreAdmin"><option value="homme">Homme</option><option value="femme">Femme</option><option value="mixte">Mixte</option></select>
        <select id="lieuAdmin"><option value="int√©rieur">Int√©rieur</option><option value="ext√©rieur">Ext√©rieur</option></select>
        <select id="type_specialAdmin"><option value="oui">Oui</option><option value="non">Non</option></select>
        <button type="submit">Ajouter/Modifier</button>
      </form>
      <table id="tableGages">
        <thead>
          <tr><th>Texte</th><th>GIF</th><th>Niveau</th><th>Ambiance</th><th>Genre</th><th>Lieu</th><th>Anal</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="game-container">
    <img id="gif" src="" alt="">
    <h2 id="texte"></h2>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://yqqhvanwoxmnakmzaqya.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxcWh2YW53b3htbmFrbXphcXlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjA4NzYsImV4cCI6MjA3NjA5Njg3Nn0.eEHQBsTKNP9_nQ6LqFBjVgx_9WX9pY1uyX7xaedvn0o' // Remplace par ta cl√©
    const supabase = createClient(supabaseUrl, supabaseKey)

    const menuButton = document.getElementById('menuButton')
    const filtersMenu = document.getElementById('filtersMenu')

    menuButton.addEventListener('click', ()=>{
      filtersMenu.style.display = filtersMenu.style.display === 'flex' ? 'none' : 'flex'
    })

    async function tirerGage() {
      const filtres = {
        niveau: document.getElementById('niveau').value,
        ambiance: document.getElementById('ambiance').value,
        genre: document.getElementById('genre').value,
        lieu: document.getElementById('lieu').value,
        type_special: document.getElementById('type_special').value
      }

      let query = supabase.from('gages').select('*')
      if(filtres.niveau) query = query.eq('niveau', filtres.niveau)
      if(filtres.ambiance) query = query.eq('ambiance', filtres.ambiance)
      if(filtres.lieu) query = query.eq('lieu', filtres.lieu)
      if(filtres.type_special) query = query.eq('type_special', filtres.type_special)
      if(filtres.genre) query = query.in('genre',[filtres.genre,'mixte'])

      const { data, error } = await query
      if(error) return console.error(error)
      if(!data || data.length===0) return alert("Aucun gage trouv√© üòÖ")

      const gage = data[Math.floor(Math.random()*data.length)]
      const gif = document.getElementById('gif')
      const texte = document.getElementById('texte')

      gif.classList.remove('visible')
      texte.classList.remove('visible')
      texte.innerHTML = ''

      gif.src = gage.gif_url||''

      const lettres = gage.texte.split('')
      lettres.forEach(l => {
        const span = document.createElement('span')
        span.textContent = l
        texte.appendChild(span)
      })

      setTimeout(()=>{
        gif.classList.add('visible')
        texte.classList.add('visible')
      },50)

      filtersMenu.style.display = 'none'
    }

    document.getElementById('btnTirer').addEventListener('click', tirerGage)

    // ===== Admin =====
    const form = document.getElementById('formGage')
    const tableBody = document.querySelector('#tableGages tbody')

    async function chargerGages() {
      const { data, error } = await supabase.from('gages').select('*').order('id')
      if(error) return console.error(error)
      tableBody.innerHTML = ''
      data.forEach(g=>{
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td>${g.texte}</td>
          <td>${g.gif_url||''}</td>
          <td>${g.niveau}</td>
          <td>${g.ambiance}</td>
          <td>${g.genre}</td>
          <td>${g.lieu}</td>
          <td>${g.type_special}</td>
          <td>
            <button onclick="modifier(${g.id})">Modifier</button>
            <button class="delete" onclick="supprimer(${g.id})">Supprimer</button>
          </td>
        `
        tableBody.appendChild(tr)
      })
    }

    form.addEventListener('submit', async e=>{
      e.preventDefault()
      const gage_id = document.getElementById('gage_id').value
      const gage = {
        texte: document.getElementById('texteAdmin').value,
        gif_url: document.getElementById('gif_urlAdmin').value,
        niveau: document.getElementById('niveauAdmin').value,
        ambiance: document.getElementById('ambianceAdmin').value,
        genre: document.getElementById('genreAdmin').value,
        lieu: document.getElementById('lieuAdmin').value,
        type_special: document.getElementById('type_specialAdmin').value
      }
      if(gage_id){
        const { error }=await supabase.from('gages').update(gage).eq('id',gage_id)
        if(error) return console.error(error)
      }else{
        const { error }=await supabase.from('gages').insert(gage)
        if(error) return console.error(error)
      }
      form.reset()
      document.getElementById('gage_id').value=''
      chargerGages()
    })

    window.modifier=async id=>{
      const { data, error }=await supabase.from('gages').select('*').eq('id',id).single()
      if(error) return console.error(error)
      document.getElementById('gage_id').value=data.id
      document.getElementById('texteAdmin').value=data.texte
      document.getElementById('gif_urlAdmin').value=data.gif_url
      document.getElementById('niveauAdmin').value=data.niveau
      document.getElementById('ambianceAdmin').value=data.ambiance
      document.getElementById('genreAdmin').value=data.genre
      document.getElementById('lieuAdmin').value=data.lieu
      document.getElementById('type_specialAdmin').value=data.type_special
    }

    window.supprimer=async id=>{
      if(!confirm('Voulez-vous vraiment supprimer ce gage ?')) return
      const { error }=await supabase.from('gages').delete().eq('id',id)
      if(error) return console.error(error)
      chargerGages()
    }

    chargerGages()
  </script>
</body>
</html>
