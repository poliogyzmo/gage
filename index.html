<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üé≤ Jeu + Admin Gages</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #fafafa;
      color: #333;
      padding: 20px;
    }
    h1 { text-align: center; }
    .tabs { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; cursor: pointer; }
    .tab { padding: 10px 20px; border-radius: 8px; background: #ddd; transition: background 0.3s; }
    .tab.active { background: #4CAF50; color: white; }
    .section { display: none; max-width: 900px; margin: auto; }
    .section.active { display: block; }

    /* Jeu */
    .filters { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
    select { padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc; background: white; }
    button { padding: 8px 16px; border-radius: 8px; border: none; background: #4CAF50; color: white; cursor: pointer; transition: 0.3s; }
    button:hover { background: #3a9c42; }
    #texte { margin-top: 20px; font-size: 1.3em; font-weight: bold; text-align:center; }
 
   /* ===== GIF responsive et grand ===== */
#gif {
  width: 100%;         /* prend toute la largeur disponible du conteneur */
  max-width: 600px;    /* limite la largeur sur grand √©cran */
  height: auto;        /* conserve les proportions */
  display: block;
  margin: 20px auto;   /* centre le GIF */
  border-radius: 10px;
  opacity: 0;
  transition: opacity 0.5s ease;
}

#gif.visible {
  opacity: 1;
}

    /* Admin */
    form, table { width: 100%; margin-top: 20px; }
    input, select { padding: 6px 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #ddd; }
    button.delete { background: #e74c3c; }

/* ===== Media Query pour mobile ===== */
@media (max-width: 600px) {
  #gif {
    max-width: 100%;  /* GIF prend toute la largeur sur petit √©cran */
  }

  </style>
</head>
<body>
  <h1>üéØ Jeu + Admin Gages</h1>

  <!-- Onglets -->
  <div class="tabs">
    <div class="tab active" data-target="jeu">üé≤ Jeu</div>
    <div class="tab" data-target="admin">‚öôÔ∏è Admin</div>
  </div>

  <!-- Section Jeu -->
  <div id="jeu" class="section active">
    <div class="filters">
      <select id="niveau"><option value="">Niveau (tous)</option><option value="mains">Avec les mains</option><option value="bouche">Avec la bouche</option><option value="avanc√©">Avanc√©</option></select>
      <select id="ambiance"><option value="">Ambiance (toutes)</option><option value="douce">Douce</option><option value="roleplay">Jeu de r√¥le</option><option value="myst√®re">Myst√®re</option></select>
      <select id="genre"><option value="">Genre (tous)</option><option value="homme">Homme</option><option value="femme">Femme</option></select>
      <select id="lieu"><option value="">Lieu (tous)</option><option value="int√©rieur">Int√©rieur</option><option value="ext√©rieur">Ext√©rieur</option></select>
      <select id="type_special"><option value="">Type sp√©cial (tous)</option><option value="oui">Oui</option><option value="non">Non</option></select>
    </div>
    <button id="btnTirer">üé≤ Tirer un gage</button>
    <h2 id="texte"></h2>
    <img id="gif" src="" alt="">
  </div>

  <!-- Section Admin -->
  <div id="admin" class="section">
    <form id="formGage">
      <input type="hidden" id="gage_id">
      <input type="text" id="texteAdmin" placeholder="Texte du gage" required style="width:60%;">
      <input type="text" id="gif_urlAdmin" placeholder="URL du GIF" style="width:35%;"><br>
      <select id="niveauAdmin"><option value="mains">Avec les mains</option><option value="bouche">Avec la bouche</option><option value="avanc√©">Avanc√©</option></select>
      <select id="ambianceAdmin"><option value="douce">Douce</option><option value="roleplay">Jeu de r√¥le</option><option value="myst√®re">Myst√®re</option></select>
      <select id="genreAdmin"><option value="homme">Homme</option><option value="femme">Femme</option><option value="mixte">Mixte</option></select>
      <select id="lieuAdmin"><option value="int√©rieur">Int√©rieur</option><option value="ext√©rieur">Ext√©rieur</option></select>
      <select id="type_specialAdmin"><option value="oui">Oui</option><option value="non">Non</option></select>
      <button type="submit">Ajouter / Modifier</button>
    </form>
    <table id="tableGages">
      <thead>
        <tr><th>Texte</th><th>GIF</th><th>Niveau</th><th>Ambiance</th><th>Genre</th><th>Lieu</th><th>Type sp√©cial</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const supabaseUrl = 'https://yqqhvanwoxmnakmzaqya.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxcWh2YW53b3htbmFrbXphcXlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjA4NzYsImV4cCI6MjA3NjA5Njg3Nn0.eEHQBsTKNP9_nQ6LqFBjVgx_9WX9pY1uyX7xaedvn0o'
    const supabase = createClient(supabaseUrl, supabaseKey)

    // ===== Tabs =====
    const tabs = document.querySelectorAll('.tab')
    const sections = document.querySelectorAll('.section')
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'))
        tab.classList.add('active')
        sections.forEach(s => s.classList.remove('active'))
        document.getElementById(tab.dataset.target).classList.add('active')
      })
    })

    // ===== Jeu =====
    async function tirerGageFiltr√©(filtres) {
      let query = supabase.from('gages').select('*')
      if(filtres.niveau) query = query.eq('niveau', filtres.niveau)
      if(filtres.ambiance) query = query.eq('ambiance', filtres.ambiance)
      if(filtres.lieu) query = query.eq('lieu', filtres.lieu)
      if(filtres.type_special) query = query.eq('type_special', filtres.type_special)
      if(filtres.genre) query = query.in('genre', [filtres.genre,'mixte'])
      const { data, error } = await query
      if(error) return console.error(error)
      if(!data || data.length===0) return alert("Aucun gage trouv√© üòÖ")
      const gage = data[Math.floor(Math.random()*data.length)]
      document.getElementById('texte').textContent = gage.texte
      const gif = document.getElementById('gif')
      gif.classList.remove('visible')
      gif.src = gage.gif_url||''
      setTimeout(()=>gif.classList.add('visible'),50)
    }

    document.getElementById('btnTirer').addEventListener('click',()=>{
      const filtres = {
        niveau: document.getElementById('niveau').value,
        ambiance: document.getElementById('ambiance').value,
        genre: document.getElementById('genre').value,
        lieu: document.getElementById('lieu').value,
        type_special: document.getElementById('type_special').value
      }
      tirerGageFiltr√©(filtres)
    })

    // ===== Admin =====
    const form = document.getElementById('formGage')
    const tbody = document.querySelector('#tableGages tbody')

    async function chargerGages() {
      const { data, error } = await supabase.from('gages').select('*')
      if(error) return console.error(error)
      tbody.innerHTML = ''
      data.forEach(gage=>{
        const tr=document.createElement('tr')
        tr.innerHTML=`
          <td>${gage.texte}</td>
          <td>${gage.gif_url?`<img src="${gage.gif_url}" width="60">`:''}</td>
          <td>${gage.niveau}</td>
          <td>${gage.ambiance}</td>
          <td>${gage.genre}</td>
          <td>${gage.lieu}</td>
          <td>${gage.type_special}</td>
          <td>
            <button onclick="modifier('${gage.id}')">‚úèÔ∏è</button>
            <button class="delete" onclick="supprimer('${gage.id}')">üóëÔ∏è</button>
          </td>
        `
        tbody.appendChild(tr)
      })
    }

    form.addEventListener('submit', async e=>{
      e.preventDefault()
      const gage_id=document.getElementById('gage_id').value
      const gage={
        texte: document.getElementById('texteAdmin').value,
        gif_url: document.getElementById('gif_urlAdmin').value,
        niveau: document.getElementById('niveauAdmin').value,
        ambiance: document.getElementById('ambianceAdmin').value,
        genre: document.getElementById('genreAdmin').value,
        lieu: document.getElementById('lieuAdmin').value,
        type_special: document.getElementById('type_specialAdmin').value
      }
      if(gage_id){
        const { error }=await supabase.from('gages').update(gage).eq('id',gage_id)
        if(error) return console.error(error)
      }else{
        const { error }=await supabase.from('gages').insert(gage)
        if(error) return console.error(error)
      }
      form.reset()
      document.getElementById('gage_id').value=''
      chargerGages()
    })

    window.modifier=async id=>{
      const { data, error }=await supabase.from('gages').select('*').eq('id',id).single()
      if(error) return console.error(error)
      document.getElementById('gage_id').value=data.id
      document.getElementById('texteAdmin').value=data.texte
      document.getElementById('gif_urlAdmin').value=data.gif_url
      document.getElementById('niveauAdmin').value=data.niveau
      document.getElementById('ambianceAdmin').value=data.ambiance
      document.getElementById('genreAdmin').value=data.genre
      document.getElementById('lieuAdmin').value=data.lieu
      document.getElementById('type_specialAdmin').value=data.type_special
    }

    window.supprimer=async id=>{
      if(!confirm('Voulez-vous vraiment supprimer ce gage ?')) return
      const { error }=await supabase.from('gages').delete().eq('id',id)
      if(error) return console.error(error)
      chargerGages()
    }

    chargerGages()
  </script>
</body>
</html>
